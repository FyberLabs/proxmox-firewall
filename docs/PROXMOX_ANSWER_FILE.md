# Proxmox Answer File (TOML) for Automated ISO Installs

This document explains the purpose, structure, and customization of the **Proxmox answer file** (`answer.toml`) used for fully automated Proxmox VE installations in this project.

---

## What is the Proxmox Answer File?

The answer file is a TOML configuration file that provides all the settings needed for an unattended Proxmox installation. It is injected into the custom ISO image, allowing the installer to run without manual input.

- **Purpose:** Automate Proxmox installs for reproducible, hands-off deployments.
- **Generated by:** Ansible playbook (`create_proxmox_iso.yml`) or setup script (`create_proxmox_iso.sh`).
- **Not usually edited directly:** Values are templated from your site config and `.env` file.

> **See also:** [Main README](../README.md#5-deploy-infrastructure) and [Development Install Guide](DEVELOPMENT_INSTALL.md#6-create-custom-proxmox-iso)

---

## Sample Answer File (TOML)

```toml
[global]
keyboard = "en-us"                # Keyboard layout
country = "us"                   # Country code
timezone = "UTC"                 # System timezone
root-password = "<hashed>"        # Root password (hashed)
mailto = "admin@example.com"      # Email for notifications
fqdn.source = "from-dhcp"         # FQDN source
fqdn.domain = "example.local"     # Domain name

[network]
source = "from-dhcp"              # Use DHCP for network config

[disk-setup]
filesystem = "ext4"               # Filesystem type
lvm.swapsize = 8                  # Swap size (GB)
lvm.maxroot = 32                  # Max root partition size (GB)
disk-list = ['sda']               # List of install disks
```

---

## Field Reference

| Section      | Field           | Description                                      |
| ------------| --------------- | ------------------------------------------------ |
| `[global]`   | keyboard        | Keyboard layout (e.g., `en-us`)                  |
|              | country         | Country code (e.g., `us`)                        |
|              | timezone        | System timezone (e.g., `UTC`, `America/New_York`)|
|              | root-password   | Root password (hashed, generated securely)       |
|              | mailto          | Admin email for notifications                    |
|              | fqdn.source     | FQDN source (`from-dhcp` or manual)              |
|              | fqdn.domain     | Domain name for the host                         |
| `[network]`  | source          | Network config source (`from-dhcp` or manual)    |
| `[disk-setup]`| filesystem     | Filesystem type (`ext4`, `zfs`, etc.)            |
|              | lvm.swapsize    | Swap partition size (GB)                         |
|              | lvm.maxroot     | Max root partition size (GB)                     |
|              | disk-list       | List of disks to install to (e.g., `['sda']`)    |

---

## How is the Answer File Generated?

- **Ansible Playbook:** `ansible-playbook deployment/ansible/playbooks/create_proxmox_iso.yml`
  - Renders `deployment/ansible/templates/proxmox-answer.toml.j2` with your site config and `.env` values.
- **Shell Script:** `deployment/scripts/create_proxmox_iso.sh`
  - Generates a similar TOML file using environment variables.
- **Output:** The answer file is injected into the custom ISO and used during install.

---

## Customizing Answer File Values

- **Do not edit the answer file directly.**
- **Customize via:**
  - Your site YAML config (`config/sites/<site_name>.yml`)
  - Your `.env` file (for secrets, admin email, etc.)
- **Common customizations:**
  - Change timezone, country, or keyboard layout in your site config.
  - Set admin email and root password in `.env`.

---

## Cross-References

- [Main README: Deploy Infrastructure](../README.md#5-deploy-infrastructure)
- [Development Install Guide: Create Custom Proxmox ISO](DEVELOPMENT_INSTALL.md#6-create-custom-proxmox-iso)
- [Ansible Playbook: create_proxmox_iso.yml](../deployment/ansible/playbooks/create_proxmox_iso.yml)
- [TOML Template: proxmox-answer.toml.j2](../deployment/ansible/templates/proxmox-answer.toml.j2)

---

> **For most users, you never need to edit the answer file directly. Use your site config and `.env` to control all settings.** 
